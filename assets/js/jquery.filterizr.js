!function(t,i){"use strict";if(!i)throw new Error("Filterizr requires jQuery to work.");var r,e=function(t){this.init(t)};e.prototype={init:function(t){this.root={x:0,y:0,w:t}},fit:function(t){var i,r,e,n=t.length,s=n>0?t[0].h:0;for(this.root.h=s,i=0;i<n;i++)e=t[i],(r=this.findNode(this.root,e.w,e.h))?e.fit=this.splitNode(r,e.w,e.h):e.fit=this.growDown(e.w,e.h)},findNode:function(t,i,r){return t.used?this.findNode(t.right,i,r)||this.findNode(t.down,i,r):i<=t.w&&r<=t.h?t:null},splitNode:function(t,i,r){return t.used=!0,t.down={x:t.x,y:t.y+r,w:t.w,h:t.h-r},t.right={x:t.x+i,y:t.y,w:t.w-i,h:r},t},growDown:function(t,i){var r;return this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+i,down:{x:0,y:this.root.h,w:this.root.w,h:i},right:this.root},(r=this.findNode(this.root,t,i))?this.splitNode(r,t,i):null}},i.fn.filterizr=function(){var t=arguments;if(this._fltr||(this._fltr=i.fn.filterizr.prototype.init(this,"object"==typeof t[0]?t[0]:void 0)),"string"==typeof t[0]){if(t[0].lastIndexOf("_")>-1)throw new Error("Filterizr error: You cannot call private methods");if("function"!=typeof this._fltr[t[0]])throw new Error("Filterizr error: There is no such function");this._fltr[t[0]](t[1],t[2])}return this},i.fn.filterizr.prototype={init:function(t,r){var e=i(t).extend(i.fn.filterizr.prototype);return e.options={animationDuration:.5,callbacks:{onFilteringStart:function(){},onFilteringEnd:function(){},onShufflingStart:function(){},onShufflingEnd:function(){},onSortingStart:function(){},onSortingEnd:function(){}},delay:0,delayMode:"progressive",easing:"ease-out",filter:"all",filterOutCss:{opacity:0,transform:"scale(0.5)"},filterInCss:{opacity:1,transform:"scale(1)"},layout:"sameSize",setupControls:!0},0===arguments.length&&(r=e.options),1===arguments.length&&"object"==typeof arguments[0]&&(r=arguments[0]),r&&e.setOptions(r),e.css({padding:0,position:"relative"}),e._lastCategory=0,e._isAnimating=!1,e._isShuffling=!1,e._isSorting=!1,e._mainArray=e._getFiltrItems(),e._subArrays=e._makeSubarrays(),e._activeArray=e._getCollectionByFilter(e.options.filter),e._toggledCategories={},e._typedText=i("input[data-search]").val()||"",e._uID="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=16*Math.random()|0;return("x"==t?i:3&i|8).toString(16)}),e._setupEvents(),e.options.setupControls&&e._setupControls(),e.filter(e.options.filter),e},filter:function(t){var i=this._getCollectionByFilter(t);this.options.filter=t,this.trigger("filteringStart"),this._handleFiltering(i),this._isSearchActivated()&&this.search(this._typedText)},toggleFilter:function(t){var i=[];this.trigger("filteringStart"),t&&(this._toggledCategories[t]?delete this._toggledCategories[t]:this._toggledCategories[t]=!0),this._multifilterModeOn()?(i=this._makeMultifilterArray(),this._handleFiltering(i),this._isSearchActivated()&&this.search(this._typedText)):(this.filter("all"),this._isSearchActivated()&&this.search(this._typedText))},search:function(t){var i=this._multifilterModeOn()?this._makeMultifilterArray():this._getCollectionByFilter(this.options.filter),r=[],e=0;if(this._isSearchActivated())for(e=0;e<i.length;e++){i[e].text().toLowerCase().indexOf(t.toLowerCase())>-1&&r.push(i[e])}if(r.length>0)this._handleFiltering(r);else if(this._isSearchActivated())for(e=0;e<this._activeArray.length;e++)this._activeArray[e]._filterOut();else this._handleFiltering(i)},shuffle:function(){this._isAnimating=!0,this._isShuffling=!0,this.trigger("shufflingStart"),this._mainArray=this._fisherYatesShuffle(this._mainArray),this._subArrays=this._makeSubarrays();var t=this._multifilterModeOn()?this._makeMultifilterArray():this._getCollectionByFilter(this.options.filter);this._isSearchActivated()?this.search(this._typedText):this._placeItems(t)},sort:function(t,i){if(t=t||"domIndex",i=i||"asc",this._isAnimating=!0,this._isSorting=!0,this.trigger("sortingStart"),"domIndex"!==t&&"sortData"!==t&&"w"!==t&&"h"!==t)for(var r=0;r<this._mainArray.length;r++)this._mainArray[r][t]=this._mainArray[r].data(t);this._mainArray.sort(this._comparator(t,i)),this._subArrays=this._makeSubarrays();var e=this._multifilterModeOn()?this._makeMultifilterArray():this._getCollectionByFilter(this.options.filter);this._isSearchActivated()?this.search(this._typedText):this._placeItems(e)},setOptions:function(t){var i=0;for(var r in t)this.options[r]=t[r];if(this._mainArray&&(t.animationDuration||t.delay||t.easing||t.delayMode))for(i=0;i<this._mainArray.length;i++)this._mainArray[i].css("transition","all "+this.options.animationDuration+"s "+this.options.easing+" "+this._mainArray[i]._calcDelay()+"ms");t.callbacks&&(t.callbacks.onFilteringStart||(this.options.callbacks.onFilteringStart=function(){}),t.callbacks.onFilteringEnd||(this.options.callbacks.onFilteringEnd=function(){}),t.callbacks.onShufflingStart||(this.options.callbacks.onShufflingStart=function(){}),t.callbacks.onShufflingEnd||(this.options.callbacks.onShufflingEnd=function(){}),t.callbacks.onSortingStart||(this.options.callbacks.onSortingStart=function(){}),t.callbacks.onSortingEnd||(this.options.callbacks.onSortingEnd=function(){})),this.options.filterInCss.transform||(this.options.filterInCss.transform="translate3d(0,0,0)"),this.options.filterOutCss.transform||(this.options.filterOutCss.transform="translate3d(0,0,0)")},_getFiltrItems:function(){var t=this,r=i(t.find(".filtr-item")),e=[];return i.each(r,function(r,s){var o=i(s).extend(n)._init(r,t);e.push(o)}),e},_makeSubarrays:function(){for(var t=[],i=0;i<this._lastCategory;i++)t.push([]);for(i=0;i<this._mainArray.length;i++)if("object"==typeof this._mainArray[i]._category)for(var r=this._mainArray[i]._category.length,e=0;e<r;e++)t[this._mainArray[i]._category[e]-1].push(this._mainArray[i]);else t[this._mainArray[i]._category-1].push(this._mainArray[i]);return t},_makeMultifilterArray:function(){for(var t=[],i={},r=0;r<this._mainArray.length;r++){var e=this._mainArray[r],n=!1,s=e.domIndex in i==!1;if(Array.isArray(e._category)){for(var o=0;o<e._category.length;o++)if(e._category[o]in this._toggledCategories){n=!0;break}}else e._category in this._toggledCategories&&(n=!0);s&&n&&(i[e.domIndex]=!0,t.push(e))}return t},_setupControls:function(){var t=this;i("*[data-filter]").click(function(){var r=i(this).data("filter");t.options.filter!==r&&t.filter(r)}),i("*[data-multifilter]").click(function(){var r=i(this).data("multifilter");"all"===r?(t._toggledCategories={},t.filter("all")):t.toggleFilter(r)}),i("*[data-shuffle]").click(function(){t.shuffle()}),i("*[data-sortAsc]").click(function(){var r=i("*[data-sortOrder]").val();t.sort(r,"asc")}),i("*[data-sortDesc]").click(function(){var r=i("*[data-sortOrder]").val();t.sort(r,"desc")}),i("input[data-search]").keyup(function(){t._typedText=i(this).val(),t._delayEvent(function(){t.search(t._typedText)},250,t._uID)})},_setupEvents:function(){var r=this;i(t).resize(function(){r._delayEvent(function(){r.trigger("resizeFiltrContainer")},250,r._uID)}),r.on("resizeFiltrContainer",function(){r._multifilterModeOn()?r.toggleFilter():r.filter(r.options.filter)}).on("filteringStart",function(){r.options.callbacks.onFilteringStart()}).on("filteringEnd",function(){r.options.callbacks.onFilteringEnd()}).on("shufflingStart",function(){r._isShuffling=!0,r.options.callbacks.onShufflingStart()}).on("shufflingEnd",function(){r.options.callbacks.onShufflingEnd(),r._isShuffling=!1}).on("sortingStart",function(){r._isSorting=!0,r.options.callbacks.onSortingStart()}).on("sortingEnd",function(){r.options.callbacks.onSortingEnd(),r._isSorting=!1})},_calcItemPositions:function(){var t=this._activeArray,r=0,n=Math.round(this.width()/this.find(".filtr-item").outerWidth()),s=0,o=t[0].outerWidth(),a=0,l=0,h=0,f=0,u=0,c=[];if("packed"===this.options.layout){i.each(this._activeArray,function(t,i){i._updateDimensions()});var g=new e(this.outerWidth());for(g.fit(this._activeArray),f=0;f<t.length;f++)c.push({left:t[f].fit.x,top:t[f].fit.y});r=g.root.h}if("horizontal"===this.options.layout)for(s=1,f=1;f<=t.length;f++)o=t[f-1].outerWidth(),a=t[f-1].outerHeight(),c.push({left:l,top:h}),l+=o,r<a&&(r=a);else if("vertical"===this.options.layout){for(f=1;f<=t.length;f++)a=t[f-1].outerHeight(),c.push({left:l,top:h}),h+=a;r=h}else if("sameHeight"===this.options.layout){s=1;var _=this.outerWidth();for(f=1;f<=t.length;f++){o=t[f-1].width();var d=t[f-1].outerWidth(),p=0;t[f]&&(p=t[f].width()),c.push({left:l,top:h}),(u=l+o+p)>_?(u=0,l=0,h+=t[0].outerHeight(),s++):l+=d}r=s*t[0].outerHeight()}else if("sameWidth"===this.options.layout){for(f=1;f<=t.length;f++){if(c.push({left:l,top:h}),f%n==0&&s++,l+=o,h=0,s>0)for(u=s;u>0;)h+=t[f-n*u].outerHeight(),u--;f%n==0&&(l=0)}for(f=0;f<n;f++){for(var y=0,m=f;t[m];)y+=t[m].outerHeight(),m+=n;y>r?(r=y,y=0):y=0}}else if("sameSize"===this.options.layout){for(f=1;f<=t.length;f++)c.push({left:l,top:h}),l+=o,f%n==0&&(h+=t[0].outerHeight(),l=0);r=(s=Math.ceil(t.length/n))*t[0].outerHeight()}return this.css("height",r),c},_handleFiltering:function(t){for(var i=this._getArrayOfUniqueItems(this._activeArray,t),r=0;r<i.length;r++)i[r]._filterOut();this._activeArray=t,this._placeItems(t)},_multifilterModeOn:function(){return Object.keys(this._toggledCategories).length>0},_isSearchActivated:function(){return this._typedText.length>0},_placeItems:function(t){this._isAnimating=!0,this._itemPositions=this._calcItemPositions();for(var i=0;i<t.length;i++)t[i]._filterIn(this._itemPositions[i])},_getCollectionByFilter:function(t){return"all"===t?this._mainArray:this._subArrays[t-1]},_makeDeepCopy:function(t){var i={};for(var r in t)i[r]=t[r];return i},_comparator:function(t,i){return function(r,e){return"asc"===i?r[t]<e[t]?-1:r[t]>e[t]?1:0:"desc"===i?e[t]<r[t]?-1:e[t]>r[t]?1:0:void 0}},_getArrayOfUniqueItems:function(t,i){var r,e,n=[],s={},o=i.length;for(r=0;r<o;r++)s[i[r].domIndex]=!0;for(o=t.length,r=0;r<o;r++)(e=t[r]).domIndex in s||n.push(e);return n},_delayEvent:(r={},function(t,i,e){if(null===e)throw Error("UniqueID needed");r[e]&&clearTimeout(r[e]),r[e]=setTimeout(t,i)}),_fisherYatesShuffle:function(t){for(var i,r,e=t.length;e;)r=Math.floor(Math.random()*e--),i=t[e],t[e]=t[r],t[r]=i;return t}};var n={_init:function(t,i){var r=this;return r._parent=i,r._category=r._getCategory(),r._lastPos={},r.domIndex=t,r.sortData=r.data("sort"),r.w=0,r.h=0,r._isFilteredOut=!0,r._filteringOut=!1,r._filteringIn=!1,r.css(i.options.filterOutCss).css({"-webkit-backface-visibility":"hidden",perspective:"1000px","-webkit-perspective":"1000px","-webkit-transform-style":"preserve-3d",position:"absolute",transition:"all "+i.options.animationDuration+"s "+i.options.easing+" "+r._calcDelay()+"ms"}),r.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){r._onTransitionEnd()}),r},_updateDimensions:function(){this.w=this.outerWidth(),this.h=this.outerHeight()},_calcDelay:function(){var t=0;return"progressive"===this._parent.options.delayMode?t=this._parent.options.delay*this.domIndex:this.domIndex%2==0&&(t=this._parent.options.delay),t},_getCategory:function(){var t=this.data("category");if("string"==typeof t){t=t.split(", ");for(var i=0;i<t.length;i++){if(isNaN(parseInt(t[i])))throw new Error("Filterizr: the value of data-category must be a number, starting from value 1 and increasing.");parseInt(t[i])>this._parent._lastCategory&&(this._parent._lastCategory=parseInt(t[i]))}}else t>this._parent._lastCategory&&(this._parent._lastCategory=t);return t},_onTransitionEnd:function(){this._filteringOut?(i(this).addClass("filteredOut"),this._isFilteredOut=!0,this._filteringOut=!1):this._filteringIn&&(this._isFilteredOut=!1,this._filteringIn=!1),this._parent._isAnimating&&(this._parent._isShuffling?this._parent.trigger("shufflingEnd"):this._parent._isSorting?this._parent.trigger("sortingEnd"):this._parent.trigger("filteringEnd"),this._parent._isAnimating=!1)},_filterOut:function(){var t=this._parent._makeDeepCopy(this._parent.options.filterOutCss);t.transform+=" translate3d("+this._lastPos.left+"px,"+this._lastPos.top+"px, 0)",this.css(t),this.css("pointer-events","none"),this._filteringOut=!0},_filterIn:function(t){var r=this._parent._makeDeepCopy(this._parent.options.filterInCss);i(this).removeClass("filteredOut"),this._filteringIn=!0,this._lastPos=t,this.css("pointer-events","auto"),r.transform+=" translate3d("+t.left+"px,"+t.top+"px, 0)",this.css(r)}}}(this,jQuery);